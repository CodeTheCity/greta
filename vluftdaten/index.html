<!doctype html>
<html lang="en">
  <head>
    <title>Interactive Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
<div id="app" class="container">
  <div class="row">
    <div class="col-md-9">
      <div id="map" class="map"></div>
    </div>
    <div class="col-md-3">
    <div
      class="form-check"
      v-for="layer in layers"
      :key="layer.id"
    >
      <label class="form-check-label">
        <input
          class="form-check-input"
          type="checkbox"
          v-model="layer.active"
          @change="layerChanged(layer.id, layer.active)"
        />
        {{ layer.name }}
      </label>
    </div>
    </div>
  </div>
</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>

  </body>
</html>

<script>
var app = new Vue({
  el: '#app',
  data: {
    map: null,
    tileLayer: null,
    layers: [
      {
        id: 0,
        name: 'Greta-V-box',
        active: false,
        features: [
          {
            id: 0,
            name: 'Greta-1',
            type: 'marker',
            coords: [57.142, -2.092],
          },
          {
            id: 1,
            name: 'Greta-2',
            type: 'marker',
            coords: [57.143, -2.098],
          },
        ],
      },
      {
        id: 1,
        name: 'City/Shire Boundaries',
        active: false,
        features: [
          {
            id: 0,
            name: 'Aberdeen',
            type: 'polygon',
            coords: [
              [57.14, -2.09],
              [57.142, -2.091],
              [57.143, -2.092],
              [57.144, -2.091],
              [57.14, -2.09],
            ],
          },{
            id: 1,
            name: 'Aberdeenshire',
            type: 'polygon',
            coords: [
              [57.14, -2.09],
              [57.142, -2.091],
              [57.143, -2.092],
              [57.144, -2.091],
              [57.14, -2.09],
            ],
          },
        ],
      }
    ],
  },
  mounted() {
    this.initMap();
    this.initLayers();
  },
  methods: {
    layerChanged(layerId, active) {
      const layer = this.layers.find(layer => layer.id === layerId);

      layer.features.forEach((feature) => {
        if (active) {
          feature.leafletObject.addTo(this.map);
        } else {
          feature.leafletObject.removeFrom(this.map);
        }
      });
    },
    initLayers() {
      this.layers.forEach((layer) => {
        const markerFeatures = layer.features.filter(feature => feature.type === 'marker');
        const polygonFeatures = layer.features.filter(feature => feature.type === 'polygon');

        markerFeatures.forEach((feature) => {
          feature.leafletObject = L.marker(feature.coords)
            .bindPopup(feature.name);
        });

        polygonFeatures.forEach((feature) => {
          feature.leafletObject = L.polygon(feature.coords)
            .bindPopup(feature.name);
        });
      });
    },
    initMap() {
      this.map = L.map('map').setView([57.14, -2.09], 12);
      this.tileLayer = L.tileLayer(
        'https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}.png',
        {
          maxZoom: 18,
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attribution">CARTO</a>',
        }
      );

      this.tileLayer.addTo(this.map);
    },
  },
});
</script>
